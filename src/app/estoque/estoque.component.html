<div class="row">
	<div class="col s12 header-pages white">
		<h1>Estoque</h1>
	</div>
</div>
<div class="row">
	<div class="col s12" *ngIf="!produtos.length">
		<div class="section"></div>
		<div class="center-align">
			<div class="grey-text text-lighten-2">
				<h2>Sem nenhum produto aqui <br><small>Clique em Novo Produto</small></h2>
				<i class="material-icons big">&#xE814;</i>
			</div>
		</div>
	</div>
	<div *ngIf="produtos.length">
		<div class="row">
			<div class="col s3">
				<div class="valign-wrapper add-new-card card red darken-1 white-text hoverable" (click)="openModal()">
					<div class="valign">
						<i class="material-icons">&#xE145;</i>
						<h4>Novo Produto</h4>
					</div>
				</div>
			</div>
			<div class="col s3" *ngFor="let produto of produtos" (click)="openModalView(produto)">
				<div class="card small hoverable">
					<div class="card-image">
						<img *ngIf="produto.images[0]" src="{{ 'https://extinfire-backend-v2-muriloeduardo.c9users.io/uploads/' + produto.images[0] }}">
						<img *ngIf="!produto.images[0]" src="https://extinfire-backend-v2-muriloeduardo.c9users.io/uploads/sem-foto.jpg">
					</div>
					<div class="card-content">
						<span class="card-title"><strong>{{ produto.nome }}</strong></span>
						<p>R$ {{ produto.valor_venda | number:'.2-2' }}</p>
						<p>Quantidade: {{ produto.qntde_atual }}</p>
						<div class="chip red" *ngIf="produto.qntde_atual <= 0">Acabou</div>
						<div class="chip orange" *ngIf="produto.qntde_atual <= produto.qntde_minima&&produto.qntde_atual > 0">Está acabando</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Modal Structure -->
<div id="modal1" class="modal modal-fixed-footer" materialize="modal" [materializeParams]="[{dismissible: false}]" [materializeActions]="modalActions">
	<form (submit)="novoProduto($event)">
		<div class="modal-content">
			<header class="modal-header red darken-1 z-depth-2">
				<div class="row">
					<div class="col s12">
						<h4>Adicionar Novo Produto</h4>
						<p>Seu estoque será contabilizado a cada novo serviço</p>
					</div>
				</div>
			</header>
			<section>
				<div class="row">
					<div class="col s7">
						<div class="section"></div>
						<div class="row">
							<div class="col-s12">
								<div class="input-field">
									<input id="nomeNovoProduto" type="text" [(ngModel)]="nome" name="nomeNovoProduto" required="" aria-required="true">
									<label for="nomeNovoProduto">Nome do produto</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col s6">
								<div class="input-field">
									<input id="valorVendaProduto" type="number" step="0.01" min="0.01" max="9999" [(ngModel)]="valor_venda" name="valorVendaProduto" >
									<label for="valorVendaProduto">Valor de venda do produto</label>
								</div>
							</div>
							<div class="col s6">
								<div class="input-field">
									<input id="valorCustoProduto" type="number" step="0.01" min="0.01" max="9999" [(ngModel)]="valor_custo" name="valorCustoProduto" >
									<label for="valorCustoProduto">Valor de custo do produto</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col s6">
								<div class="input-field">
									<input id="qntdeMinProduto" type="number" [(ngModel)]="qntde_minima" name="qntdeMinProduto" >
									<label for="qntdeMinProduto">Quantidade mínima</label>
								</div>
							</div>
							<div class="col s6">
								<div class="input-field">
									<input id="qntdeAtualProduto" type="number" [(ngModel)]="qntde_atual" name="qntdeAtualProduto" >
									<label for="qntdeAtualProduto">Quantidade atual deste produto</label>
								</div>
							</div>
						</div>
					</div>
					<div class="col s5">
						<div class="section"></div>
						<div class="row">
							<div class="lista-images">
								<div class="col s3 center-align" *ngFor="let item of uploader.queue">
									<img imgPreview [image]="item?._file" class="responsive-img">
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col s12">
								<div ng2FileDrop
					                 [ngClass]="{'nv-file-over': hasBaseDropZoneOver}"
					                 (fileOver)="fileOverBase($event)"
					                 [uploader]="uploader"
					                 class="drop-zone">
					                <i class="material-icons">&#xE439;</i>
					                <h4>Arraste e solte aqui</h4>
					                <h5>ou</h5>
					                <input type="file" ng2FileSelect [uploader]="uploader" multiple  /><br/>
					            </div>
				            </div>
						</div>
					</div>
				</div>
			</section>
		</div>
		<div class="modal-footer">
			<button type="submit" class="waves-effect waves-light btn red darken-1" name="action">Salvar e Cadastrar</button>
			<a class="modal-action modal-close waves-effect waves-light btn grey darken-4" (click)="closeModal()">Cancelar</a>
		</div>
	</form>
</div>
<!-- Modal Cada Produto Structure -->
<div id="modal2" class="modal modal-fixed-footer" materialize="modal" [materializeParams]="[{dismissible: false}]" [materializeActions]="modalViewActions">
	<form (submit)="updateProuto()">
		<div class="modal-content">
			<header class="modal-header red darken-1 z-depth-2">
				<div class="row">
					<div class="col s12">
						<h4>Visualizar e Editar Produto</h4>
						<p>Exclua, edite e visualize este produto</p>
					</div>
				</div>
			</header>
			<section>
				<div class="row">
					<div class="col s7">
						<div class="section"></div>
						<div class="row">
							<div class="col-s12">
								<div class="input-field">
									<input id="nomeNovoProduto" type="text" [(ngModel)]="produto.nome" name="nomeNovoProduto" required="" aria-required="true">
									<label for="nomeNovoProduto">Nome do produto</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col s6">
								<div class="input-field">
									<input id="valorVendaProduto" type="number" step="0.01" min="0.01" max="9999" [(ngModel)]="produto.valor_venda" name="valorVendaProduto" >
									<label for="valorVendaProduto">Valor de venda do produto</label>
								</div>
							</div>
							<div class="col s6">
								<div class="input-field">
									<input id="valorCustoProduto" type="number" step="0.01" min="0.01" max="9999" [(ngModel)]="produto.valor_custo" name="valorCustoProduto" >
									<label for="valorCustoProduto">Valor de custo do produto</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col s6">
								<div class="input-field">
									<input id="qntdeMinProduto" type="number" [(ngModel)]="produto.qntde_minima" name="qntdeMinProduto" >
									<label for="qntdeMinProduto">Quantidade mínima</label>
								</div>
							</div>
							<div class="col s6">
								<div class="input-field">
									<input id="qntdeAtualProduto" type="number" [(ngModel)]="produto.qntde_atual" name="qntdeAtualProduto" >
									<label for="qntdeAtualProduto">Quantidade atual deste produto</label>
								</div>
							</div>
						</div>
					</div>
					<div class="col s5">
						<div class="section"></div>
						<div class="row">
							<div class="lista-images">
								<div class="col s3 center-align" *ngFor="let imgProduto of produto.images">
									<a class="waves-effect waves-light btn grey darken-4" (click)="removeItemFotos(imgProduto)">
										<i class="material-icons">&#xE92B;</i>
									</a>
									<img src="{{ 'https://extinfire-backend-v2-muriloeduardo.c9users.io/uploads/' + imgProduto }}" class="responsive-img">
								</div>
								<div class="col s3 center-align" *ngFor="let item of uploader.queue">
									<a class="waves-effect waves-light btn grey darken-4" (click)="item.remove()">
										<i class="material-icons">&#xE92B;</i>
									</a>
									<img imgPreview [image]="item?._file" class="responsive-img">
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col s12">
								<div ng2FileDrop
					                 [ngClass]="{'nv-file-over': hasBaseDropZoneOver}"
					                 (fileOver)="fileOverBase($event)"
					                 [uploader]="uploader"
					                 class="drop-zone">
					                <i class="material-icons">&#xE439;</i>
					                <h4>Arraste e solte aqui</h4>
					                <h5>ou</h5>
					                <input type="file" ng2FileSelect [uploader]="uploader" multiple  /><br/>
					            </div>
				            </div>
						</div>
					</div>
				</div>
			</section>
		</div>
		<div class="modal-footer">
			<a class="waves-effect waves-red btn-flat" (click)="closeModalView()">Cancelar</a>
			<button type="submit" class="waves-effect waves-light btn red darken-1" name="action">Editar e Salvar</button>
			<a class="waves-effect waves-light btn grey darken-4" (click)="deleteProduto(produto._id)">Excluir</a>
		</div>
	</form>
</div>